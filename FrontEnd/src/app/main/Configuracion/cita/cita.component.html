<div id="cita" class="page-layout carded fullwidth inner-scroll">

    <!-- TOP BACKGROUND -->
    <div class="top-bg accent"></div>
    <!-- / TOP BACKGROUND -->

    <!-- CENTER -->
    <div class="center">

        <!-- HEADER -->
        <div class="header accent" fxLayout="row" fxLayoutAlign="space-between center">

            <!-- APP TITLE -->
            <div fxLayout="row" fxLayoutAlign="start center">

                <button mat-icon-button class="mr-0 mr-sm-16" [routerLink]="'/configuracion/citas/'+this.expItem">
                    <mat-icon>arrow_back</mat-icon>
                </button>

                <!-- <div class="product-image mr-8 mr-sm-16" [@animate]="{value:'*',params:{delay:'50ms',scale:'0.2'}}">
                    <img *ngIf="product.images[0]" [src]="product.images[0].url">
                    <img *ngIf="!product.images[0]" [src]="'assets/images/ecommerce/product-image-placeholder.png'">
                </div> -->

                <!-- <div fxLayout="column" fxLayoutAlign="start start" [@animate]="{value:'*',params:{delay:'100ms',x:'-25px'}}">
                    <div class="h2" *ngIf="pageType ==='edit'">
                        {{product.name}}
                    </div>
                    <div class="h2" *ngIf="pageType ==='new'">
                        New Product
                    </div>
                    <div class="subtitle secondary-text">
                        <span>Product Detail</span>
                    </div>
                </div> -->


                <div fxLayout="column" fxLayoutAlign="start start" [@animate]="{value:'*',params:{delay:'100ms',x:'-25px'}}">
                    <div class="h2" *ngIf="pageType !='new'">
                        {{cita.ccita}}
                    </div>
                    <div class="h2" *ngIf="pageType ==='new'">
                        Nueva Cita - {{this.CitaNum}}
                    </div>
                    <div class="subtitle secondary-text">
                        <span>Detalle Cita</span>
                    </div>
                </div>


            </div>
            <!-- / APP TITLE -->

            <button mat-raised-button class="save-product-button" [disabled]="citaForm.invalid" *ngIf="pageType ==='new'" (click)="addCita()">
        <span>ADD</span>
    </button>

            <button mat-raised-button class="save-product-button" [disabled]="citaForm.invalid || citaForm.pristine" *ngIf="pageType !='new'" (click)="saveCita()">
        <span>SAVE</span>
    </button>

        </div>
        <!-- / HEADER -->

        <!-- CONTENT CARD -->
        <div class="content-card">

            <!-- CONTENT -->
            <div class="content">

                <form name="citaForm" [formGroup]="citaForm" class="product w-100-p" fxLayout="column" fxFlex>

                    <mat-tab-group>

                        <mat-tab label="Cita">

                            <div class="tab-content p-24" fusePerfectScrollbar>



                                <!-- <mat-form-field appearance="outline" floatLabel="always" class="w-100-p">
                                    <mat-label>Sucursal</mat-label>
                                    <input matInput placeholder="Sucursal" name="sucursal" formControlName="sucursal" type="text">
                                </mat-form-field> -->

                                <div fxLayout="row" fxLayoutAlign="start center">
                                    <mat-form-field appearance="outline" floatLabel="always" fxFlex="30">
                                        <mat-label>Cita #</mat-label>
                                        <input matInput placeholder="Codigo" readonly="readonly" name="ccita" formControlName="ccita">
                                    </mat-form-field>
                                    <!-- 
                                    <mat-form-field appearance="outline" floatLabel="always" fxFlex="35" class="pl-100">
                                        <mat-label>Expediente #</mat-label>
                                        <input matInput type="number" ng-pattern="/^[0-9]+(\.[0-9]{1,2})?$/" required placeholder="Expediente" name="cexp" formControlName="cexp">
                            
                                    </mat-form-field> -->

                                    <!-- <mat-form-field appearance="outline" fxFlex="70" class="pr-4 expItem">
                                        <mat-label>Expediente</mat-label>
                                        <input matInput placeholder="Expediente" formControlName="cexp" [(ngModel)]="expItem" aria-label="Expediente" [matAutocomplete]="auto" [formControl]="ExpedienteCtrl">
                                        <mat-autocomplete #autoexpe="matAutocomplete">
                                            <mat-option *ngFor="let exe of filteredExpediente | async" [value]="exe.cexp">

                                                <span>{{exe.cexp}} | </span>
                                                <small>{{exe.name}}</small>

                                            </mat-option>
                                        </mat-autocomplete>

                                    </mat-form-field> -->


                                    <mat-form-field appearance="outline" fxFlex="30" class="pr-4">
                                        <mat-label>Expediente</mat-label>
                                        <input matInput placeholder="Expediente" formControlName="cexp" [(ngModel)]="expItem" [matAutocomplete]="auto" [formControl]="ExpedienteCtrl" (keydown.enter)="datos($event)">
                                        <mat-autocomplete #auto="matAutocomplete">
                                            <mat-option *ngFor="let exe of filteredExpediente | async" [value]="exe.cexp">

                                                <span>{{exe.cexp}} | </span>
                                                <small>{{exe.name}}</small>

                                            </mat-option>
                                        </mat-autocomplete>
                                        <mat-error>Expediente is required!</mat-error>
                                    </mat-form-field>


                                </div>

                                <!-- <mat-form-field appearance="outline" fxFlex="70" class="pr-4 productItem">
                                    <mat-label>Productos</mat-label>
                                    <input matInput placeholder="ItemCode" formControlName="ItemCode" aria-label="ItemCode" [matAutocomplete]="autoproducts" [formControl]="productosCtrl" (keydown.enter)="completeProducts($event)">
                                    <mat-autocomplete #autoproducts="matAutocomplete">
                                        <mat-option *ngFor="let products of filteredProducts | async" [value]="products.ItemCode">

                                            <span>{{products.ItemCode}} | </span>
                                            <small>{{products.ItemName}}</small>

                                        </mat-option>
                                    </mat-autocomplete>

                                </mat-form-field> -->



                                <div fxLayout="row" fxLayoutAlign="space-between">


                                    <mat-form-field appearance="outline" floatLabel="always" fxFlex="30">
                                        <mat-label>Peso Anterior</mat-label>
                                        <input matInput placeholder="Peso Inicial" name="pesoini" formControlName="pesoini" type="number" ng-pattern="/^[0-9]+(\.[0-9]{1,2})?$/" required>
                                        <!-- <span matSuffixe>cm</span> -->
                                    </mat-form-field>

                                    <mat-form-field appearance="outline" floatLabel="always" fxFlex="30">
                                        <mat-label>Peso Actual</mat-label>
                                        <input matInput placeholder="Peso Actual" name="pesoact" formControlName="pesoact" type="number" ng-pattern="/^[0-9]+(\.[0-9]{1,2})?$/" required>
                                        <!-- <span matSuffix>cm</span> -->
                                    </mat-form-field>

                                    <mat-form-field appearance="outline" floatLabel="always" fxFlex="30">
                                        <mat-label>Talla</mat-label>
                                        <mat-select formControlName="talla">
                                            <mat-option [value]="'S'">
                                                S
                                            </mat-option>
                                            <mat-option [value]="'M'">
                                                M
                                            </mat-option>
                                            <mat-option [value]="'L'">
                                                L
                                            </mat-option>
                                            <mat-option [value]="'XL'">
                                                XL
                                            </mat-option>
                                            <mat-option [value]="'XXL'">
                                                XXL
                                            </mat-option>
                                            <mat-option [value]="'XXXL'">
                                                XXXL
                                            </mat-option>

                                        </mat-select>
                                        <!-- <mat-icon matSuffix class="secondary-text">outlined_flag</mat-icon>
                                        <mat-error>Estado is required!</mat-error> -->
                                    </mat-form-field>



                                </div>
                                <div fxLayout="row" fxLayoutAlign="space-between">


                                    <mat-form-field appearance="outline" floatLabel="always" fxFlex="30">
                                        <mat-label>Tallacms</mat-label>
                                        <input matInput placeholder="Tallacms" name="tallacms" formControlName="tallacms" type="number" ng-pattern="/^[0-9]+(\.[0-9]{1,2})?$/" required>
                                        <!-- <span matSuffix>cm</span> -->
                                    </mat-form-field>

                                    <mat-form-field appearance="outline" floatLabel="always" fxFlex="30">
                                        <mat-label>IMC</mat-label>
                                        <input matInput placeholder="IMC" name="imc" formControlName="imc" type="number" ng-pattern="/^[0-9]+(\.[0-9]{1,2})?$/" required>
                                        <!-- <span matSuffix>cm</span> -->
                                    </mat-form-field>

                                    <mat-form-field appearance="outline" floatLabel="always" fxFlex="30">
                                        <mat-label>PTR</mat-label>
                                        <input matInput placeholder="PTR" name="ptr" formControlName="ptr" type="number" ng-pattern="/^[0-9]+(\.[0-9]{1,2})?$/" required>
                                        <!-- <span matSuffix>cm</span> -->
                                    </mat-form-field>

                                </div>

                                <div fxLayout="row" fxLayoutAlign="space-between">

                                    <mat-form-field appearance="outline" floatLabel="always" fxFlex="30">
                                        <mat-label>Area Grasa</mat-label>
                                        <input matInput placeholder="Area Grasa" name="areagrasa" formControlName="areagrasa">
                                        <!-- <span matSuffix>cm</span> -->
                                    </mat-form-field>

                                    <mat-form-field appearance="outline" floatLabel="always" fxFlex="30">
                                        <mat-label>Grasa Muscular</mat-label>
                                        <input matInput type="number" ng-pattern="/^[0-9]+(\.[0-9]{1,2})?$/" required placeholder="Grasa Muscular" name="areamusc" formControlName="areamusc">
                                        <!-- <span matSuffix>cm</span> -->
                                    </mat-form-field>

                                    <mat-form-field appearance="outline" fxFlex="30">
                                        <mat-label>Fecha Visita</mat-label>
                                        <input matInput [matDatepicker]="visitaDatePicker" name="fechavisita" formControlName="fechavisita">
                                        <mat-datepicker-toggle matSuffix [for]="visitaDatePicker"></mat-datepicker-toggle>
                                        <mat-datepicker #visitaDatePicker></mat-datepicker>
                                    </mat-form-field>




                                </div>

                                <div fxLayout="row" fxLayoutAlign="space-between">


                                    <mat-form-field appearance="outline" floatLabel="always" fxFlex="30">
                                        <mat-label>Telefono</mat-label>
                                        <input matInput required placeholder="Telefono" name="telefono" formControlName="telefono">
                                        <!-- <span matSuffix>cm</span> -->
                                    </mat-form-field>



                                    <mat-form-field appearance="outline" floatLabel="always" fxFlex="30">
                                        <mat-label>Correo</mat-label>
                                        <input matInput required placeholder="Correo" name="correo" formControlName="correo">
                                        <!-- <span matSuffix>cm</span> -->
                                    </mat-form-field>



                                    <mat-form-field appearance="outline" fxFlex="30">
                                        <mat-label>Proxima Visita</mat-label>
                                        <input matInput [matDatepicker]="proximaDatePicker" name="proximavisita" formControlName="proximavisita">
                                        <mat-datepicker-toggle matSuffix [for]="proximaDatePicker"></mat-datepicker-toggle>
                                        <mat-datepicker #proximaDatePicker></mat-datepicker>
                                    </mat-form-field>

                                </div>

                                <div fxLayout="row" fxLayoutAlign="start center">



                                    <mat-form-field appearance="outline" floatLabel="always" fxFlex="35" class="pl-100">
                                        <mat-label>Estado</mat-label>
                                        <mat-select formControlName="estado">
                                            <mat-option [value]="'Activo'">
                                                Activo
                                            </mat-option>
                                            <mat-option [value]="'Inactivo'">
                                                Inactivo
                                            </mat-option>

                                        </mat-select>
                                        <!-- <mat-icon matSuffix class="secondary-text">outlined_flag</mat-icon>
                                    <mat-error>Estado is required!</mat-error> -->
                                    </mat-form-field>

                                </div>


                            </div>

                        </mat-tab>

                        <mat-tab label="Productos">

                            <!-- <button (click)="guardarpago()">
                                <mat-icon>agregar pago</mat-icon>
                            </button> -->


                            <div class="mb-24" fxLayout="column" fxLayoutAlign="start" fxLayout.gt-md="row">


                                <form class="mat-card mat-elevation-z4 p-24 mr-24" fxLayout="column" fxLayoutAlign="start" fxFlex="1 0 auto" name="form" [formGroup]="statusForm">


                                    <div fxLayout="row" fxLayoutAlign="start center" fxFlex="1 0 auto">
                                        <mat-form-field appearance="outline" fxFlex="70" class="pr-4 productItem">
                                            <mat-label>Productos</mat-label>
                                            <input matInput placeholder="ItemCode" formControlName="ItemCode" aria-label="ItemCode" [matAutocomplete]="autoproducts" [(ngModel)]="productItem" [formControl]="productosCtrl" (keydown.enter)="completeProducts($event)">
                                            <mat-autocomplete #autoproducts="matAutocomplete">
                                                <mat-option *ngFor="let products of filteredProducts | async" [value]="products.ItemCode">

                                                    <span>{{products.ItemCode}} | </span>
                                                    <small>{{products.ItemName}}</small>

                                                </mat-option>
                                            </mat-autocomplete>

                                        </mat-form-field>

                                        <mat-form-field appearance="outline" fxFlex="70" class="pl-4">
                                            <mat-label>Descripcion</mat-label>
                                            <input matInput formControlName="ItemName" required>
                                            <mat-icon matSuffix class="secondary-text">article</mat-icon>
                                            <mat-error>Descripcion is required!</mat-error>
                                        </mat-form-field>

                                    </div>






                                    <div fxLayout="row" fxLayoutAlign="start center" fxFlex="1 0 auto">



                                        <mat-form-field appearance="outline" floatLabel="always" fxFlex="30">
                                            <mat-label>Cantidad</mat-label>
                                            <input matInput placeholder="Cantidad" name="cantidad" formControlName="cantidad" type="number" ng-pattern="/^[0-9]+(\.[0-9]{1,2})?$/" required>
                                            <!-- <span matSuffix>cm</span> -->
                                        </mat-form-field>

                                        <mat-form-field appearance="outline" fxFlex="30" class="pr-4">
                                            <mat-label>Proxima Compra</mat-label>
                                            <input matInput [matDatepicker]="proximafechaDatePicker" name="ProximaCompra" formControlName="ProximaCompra">
                                            <mat-datepicker-toggle matSuffix [for]="proximafechaDatePicker"></mat-datepicker-toggle>
                                            <mat-datepicker #proximafechaDatePicker></mat-datepicker>
                                        </mat-form-field>

                                        <button class="pr-6" mat-raised-button [disabled]="!statusForm.valid" class="save-product-button accent-800" fxFlex="10" (click)="Agregar()">Agregar</button>

                                    </div>


                                    <!-- <button mat-raised-button class="mat-accent" [disabled]="statusForm.invalid">
                                            Fecha
                                        </button> -->

                                    <!-- <div class="mb-24" fxLayout="column" fxLayoutAlign="start center" fxFlex="1 0 auto">
                                        <div fxLayout="row" fxLayoutAlign="start center" fxFlex="1 0 auto">
                                            <mat-label>Total Factura </mat-label>
    
                                            {{FacturaE.TotalDoc}}
                                        </div>
    
                                    </div>
                                    <div class="mb-24" fxLayout="column" fxLayoutAlign="start center" fxFlex="1 0 auto">
                                        <div fxLayout="row" fxLayoutAlign="start center" fxFlex="1 0 auto">
                                            <mat-label>Total Pagos </mat-label>
                                            {{totalpago}}
                                        </div>
                                    </div>
                                    <div class="mb-24" fxLayout="column" fxLayoutAlign="start center" fxFlex="1 0 auto">
                                        <div fxLayout="row" fxLayoutAlign="start center" fxFlex="1 0 auto">
    
                                            <mat-label>Saldo Vencido </mat-label>
                                            {{saldoVencido}}
                                        </div>
                                    </div> -->
                                    <!--     
    
                                    <table class="simple invoice-table-footer Subs1">
                                        <tbody>
                                            <tr class="subtotal">
                                                <td>TOTAL FACTURA</td>
                                                <td>{{ FacturaE.TotalDoc | currency:'LPS':'symbol'}}</td>
                                            </tr>
                                            <tr class="tax">
                                                <td>TOTAL PAGOS</td>
                                                <td>{{ totalpago | currency:'LPS':'symbol'}}</td>
                                            </tr>
    
                                            <tr class="total">
                                                <td>SALDO VENCIDO</td>
                                                <td>{{ saldoVencido | currency:'LPS':'symbol'}}</td>
                                            </tr>
                                        </tbody>
                                    </table> -->

                                </form>






                            </div>


                            <div class="section pb-48">

                                <div class="pb-16" fxLayout="row" fxLayoutAlign="start center">
                                    <mat-icon class="m-0 mr-16 secondary-text">attach_money</mat-icon>
                                    <div class="h2 secondary-text">Productos Comprados</div>
                                </div>

                                <table class="simple">
                                    <thead>
                                        <tr>
                                            <th>ProductoId</th>
                                            <th>Descripcion</th>
                                            <th>Cantidad</th>
                                            <th>Proxima Compra</th>
                                            <th>Eliminar</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr *ngFor="let inf of this.ELEMENT_DATA">
                                            <td>
                                                <span class="text-truncate">
                                                    {{inf.ItemCode}}
                                                </span>

                                            </td>
                                            <td>
                                                <span class="text-truncate">
                                                    {{inf.ItemName}}
                                                </span>

                                            </td>
                                            <td>

                                                <span class="text-truncate">
                                                    {{inf.cantidad}}
                                                </span>
                                            </td>
                                            <td>

                                                <span class="text-truncate">
                                                    {{getFormattedDate( inf.ProximaCompra) | date}}
                                                </span>
                                            </td>
                                            <td>
                                                <span>
                                                    <button class="pr-6" mat-raised-button class="save-product-button accent-800" fxFlex="35" (click)="eliminar(inf)">Eliminar</button>

                                                </span>
                                            </td>

                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </mat-tab>


                    </mat-tab-group>

                </form>

            </div>
            <!-- / CONTENT -->

        </div>
        <!-- / CONTENT CARD -->

    </div>
    <!-- / CENTER -->

</div>